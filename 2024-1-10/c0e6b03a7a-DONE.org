#+INCLUDE: "../../prefix.org"

#+TITLE: pr_err和dev_err的区别

https://cursorhu.github.io/2023/08/02/Linux%20driver%E5%B8%B8%E7%94%A8%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF/
#+begin_src c
  #define KERN_EMERG	KERN_SOH "0"	/* system is unusable */
  #define KERN_ALERT	KERN_SOH "1"	/* action must be taken immediately */
  #define KERN_CRIT	KERN_SOH "2"	/* critical conditions */
  #define KERN_ERR	KERN_SOH "3"	/* error conditions */
  #define KERN_WARNING	KERN_SOH "4"	/* warning conditions */
  #define KERN_NOTICE	KERN_SOH "5"	/* normal but significant condition */
  #define KERN_INFO	KERN_SOH "6"	/* informational */
  #define KERN_DEBUG	KERN_SOH "7"	/* debug-level messages */

  #define KERN_DEFAULT	""		/* the default kernel loglevel */

  #ifndef pr_fmt
  #define pr_fmt(fmt) fmt
  #endif
  #define pr_xxx(fmt, ...) printk(KERNEL_XXX pr_fmt(fmt), ##__VA_ARGS__)

#+end_src
pr_xxx类型需要在文件最前面，#include<linux/printk.h>之前加上：
#+begin_src c
#define pr_fmt(fmt) "hw-breakpoint: " fmt
#+end_src
其他和printk没啥两样，也就是打印内容会编译进binary，需要通过打印级别打开；

https://blog.csdn.net/boyemachao/article/details/104801366
#+begin_src c
  #ifndef dev_fmt
  #define dev_fmt(fmt) fmt
  #endif

  #define dev_xxx(dev, fmt, ...) \
	  dev_printk_index_wrap(_dev_xxx, KERN_XXX, dev, dev_fmt(fmt), ##__VA_ARGS__)

  #define dev_printk_index_wrap(_p_func, level, dev, fmt, ...)		\
	({								\
		dev_printk_index_emit(level, fmt);			\
		_p_func(dev, fmt, ##__VA_ARGS__);			\
	})

  #define dev_printk_index_emit(level, fmt, ...) \
	printk_index_subsys_emit("%s %s: ", level, fmt)

#+end_src
