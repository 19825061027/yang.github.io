#+INCLUDE: "../../prefix.org"

#+TITLE: Overflow handling

reference:: manual perf_event_open
- 时间可以设置阈值提醒,指明已经溢出;
- 溢出条件可以通过poll/select/epoll监控fd;
- 另一种方案,可以通过sa信号handler捕获,前提是在fd上使能IO信号;

溢出只能被采样事件产生(sample_period必须非零);  
两种产生溢出提示的方法:
1. 设置wakeup_events 或 wakeup_watermark, 当一个确定数量的采样或字节写道mmap ring-buffer中时, 会触发.这种情况下,需要指明POLL_IN.
2. 使用PERF_EVENT_IOC_REFRESH ioctl. 这个ioctl添加到一个计数器,这个计数器在每次事件溢出时减少. 当非零时,POLL_IN被指明, 但一旦counter减到0,POLL_HUP就被指明,并且底层事件被失能.

更新事件组长就会更新所有姊妹, 带有参数0的跟新会使能无尽的更新;这些行为不支持并且不依赖;

自Linux3.18, 如果监控事件附着于一个不同的进程,那个进程退出了,POLL_HUP被指明;
